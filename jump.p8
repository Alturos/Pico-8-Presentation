pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- over and under
-- ava~

step = .03333 -- our framerate, 1/30

function _init()
	menuitem(1, "next demo", loadnextdemo)
	frames = { 3, 4, 2, 1}
	frametime	= 0
	frameidx = 1
	
	speed = 30
	x,y = 60, 60
	walking = false
	left = false
	
	-- define a variable to track
	-- our jump state
	jumping = false
	-- another to determine if
	-- we're on the ground
	onground = true
	-- one to track our jump time
	jumptime = 0
	-- and finally, one to track
	-- our crouched state
	crouched = false
end

function _update()
	frametime += 1
	walking = false
	-- always reset our 
	-- jumping/crouching flag, 
	-- they're input dependent 
	-- and shouldn't persist
	jumping = false
	crouched = false
	
	if(btn(0)) then
		x -= speed * step 
		walking = true 
		left = true
	end
	if(btn(1)) then
		x += speed * step 
		walking = true 
		left = false
	end
	
	-- if we've pressed down and
	-- are on the ground, then 
	-- crouch!
	if(btn(3) and not walking and onground) then
		frameidx = 9
		crouched = true
	end
	
	-- if we've pressed jump, 
	-- and are on the ground or 
	-- ascending
	if(btn(5) and (onground or jumptime < 15)) then
		-- set our jumping flag, 
		-- clear the onground flag 
		-- and ascend
		jumping = true
		onground = false
		y -= speed * step
	end
	
	if(not onground) then
		if(jumping) then
			-- if we're jumping, 
			-- set our jump frame and 
			-- increment our jump time
			frameidx = 5
			jumptime += 1
		else
			-- otherwise we're falling,
			-- so descend
			frameidx = 6
			y += speed * step
			-- set our jumptime to the
			-- max
			jumptime = 15
			if(y >= 60) then
				-- we've landed on the
				-- ground, make sure not
				-- to overshoot
				onground = true
				y = 60
				-- reset our jumptime so
				-- we can jump again
				jumptime = 0
			end
		end
	elseif(walking) then
		-- do all the frame updating
		-- stuff we just coded
		if(frametime > 5) then
				frametime = 0
			 frameidx += 1
		end
		if(frameidx > 4) then
			frameidx = 1
		end
	elseif(not crouched) then
		-- otherwise, reset the
		-- animation state.
		frametime = 0
		frameidx = 0
	end
end

function _draw()
	cls(12)
	map(0,0,0,28,16,16)
	if(onground and walking) then
		spr(frames[frameidx], x, y, 1, 1, left)
	else 
		-- if we're not walking,
		-- we could be jumping,
		-- crouching or falling,
		-- so use frameidx
		spr(frameidx,x,y,1,1,left) 
	end
	print("jump", 112, 122, 7)
end

-->8
-- demo switching

function loadnextdemo()
	load('scrolling.p8', 'previous demo')	
end
__gfx__
002d2200002d2200002d2200002d2200002d2200002d2200028d2200220000000000000000000000000000000000000000000000000000000000000000000000
00822400008224000082240000822400008224000882440028224400022800000000000000000000000000000000000000000000000000000000000000000000
008244000082440000824400008244000082440008224400222244000282d200028d2200002d2200000000000000000000000000000000000000000000000000
00229a0000229a0000229a0000229a0000229a0002229a4004429a00022244002822440000822400000000000000000000000000000000000000000000000000
00024a0000024a000004aa400042a40000024a000049aa000009aa40002244002222440000824400000000000000000000000000000000000000000000000000
00004a000000a4000009490000099a400000a400042aad00000aad0000049a4000029a4000229a40000000000000000000000000000000000000000000000000
0000d5000001d50000050d00000d05000001dd0000d01000000d01000040aad00004aaa000024a90000000000000000000000000000000000000000000000000
000011000000100000100100001001000000100001000000000010000000151000014a1000019410000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3b3b3b444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3b3b3b3444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44344434444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3030303030303030303030303030303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
